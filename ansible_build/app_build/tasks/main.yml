---
- hosts: localhost
  gather_facts: no
  tasks:
    - name: create build directory
      file:
        path: /tmp/demo-dockerfile
        state: directory
        owner: root
        group: root
        mode: '0755'
    - name: copy Dockerfile
      copy:
        src: ./voting_app/
        dest: /tmp/demo-dockerfile
        owner: root
        group: root
        mode: '0644'
    - name: build container image
      docker_image:
        name: democontainer:v1.0
        build:
          path: /tmp/demo-dockerfile
        source: build
        state: present

    - name: archive container image as a tarball
      docker_image:
        name: democontainer:v1.0
        archive_path: /tmp/democontainer_v1_0.tar
        timeout: 120
        source: pull
        state: present


- hosts: docker_hosts
  gather_facts: no
  tasks:
    - name: copy tarball to host
      copy:
        src: /tmp/democontainer_v1_0.tar
        dest: /tmp/democontainer_v1_0.tar

    - name: load container from tarball
      docker_image:
        name: democontainer:v1.0
        load_path: /tmp/democontainer_v1_0.tar
        timeout: 120
        state: present
        source: load


